# LiveKit Hello-Room Example

This repository provides a **step-by-step** Hello-Room example using LiveKit Cloud and the LiveKit JavaScript SDK. It includes:

- **Backend**: `generate_token.py` (Flask microservice to generate LiveKit JWT tokens)
- **Frontend**:

  - `index.html` (HTML UI with a Join button and video placeholder)
  - `app.jsx` (ES module that handles room connection, media publishing, and video rendering)

---

## Table of Contents

1. [Prerequisites](#prerequisites)
2. [Setup](#setup)
3. [Backend: `generate_token.py`](#backend-generate_tokenpy)
4. [Frontend: `index.html` & `app.jsx`](#frontend-indexhtml--appjsx)

   - [HTML Structure](#html-structure)
   - [JavaScript Logic (Line-by-Line)](#javascript-logic-line-by-line)

5. [Running the Example](#running-the-example)
6. [How It Works](#how-it-works)

---

## Prerequisites

- Python 3.7+ and `pip`
- Node.js 14+ and `npm`
- LiveKit Cloud project (or self-hosted) with **API Key** & **Secret**
- Basic familiarity with Flask, JavaScript modules

---

## Setup

### 1. Clone & Install Backend

```bash
git clone <repo-url>
cd <repo>/backend
python3 -m venv venv
source venv/bin/activate
pip install flask python-dotenv livekit-server-sdk
```

Create a `.env`:

```ini
LIVEKIT_API_KEY=<your_api_key>
LIVEKIT_API_SECRET=<your_api_secret>
```

### 2. Setup Frontend

```bash
cd ../frontend           # adjust path if needed
npm init -y
npm install livekit-client
```

---

## Backend: `generate_token.py`

```python
import os
from flask import Flask
from livekit import api
from dotenv import load_dotenv

load_dotenv()       # load .env variables
app = Flask(__name__)

@app.route('/getToken')
def getToken():
    # Create token with API key/secret
    token = api.AccessToken(
        os.getenv('LIVEKIT_API_KEY'),
        os.getenv('LIVEKIT_API_SECRET')
    )
    # Set identity and display name
    token = token.with_identity("identity")
    token = token.with_name("my name")
    # Grant room join rights for "my-room"
    token = token.with_grants(
        api.VideoGrants(room_join=True, room="my-room")
    )
    # Return signed JWT
    return token.to_jwt()

if __name__ == '__main__':
    app.run(port=5000)
```

- **`load_dotenv()`**: Reads `.env` for API credentials.
- **`/getToken`**: Returns a JWT with:

  - `identity`: fixed string.
  - `name`: metadata shown in UI.
  - `VideoGrants`: allows joining & publishing in `my-room`.

---

## Frontend: `index.html` & `app.jsx`

### HTML Structure (`index.html`)

```html
<!DOCTYPE html>
<html>
  <head>
    <title>LiveKit Hello-Room</title>
  </head>
  <body>
    <h1>LiveKit Room</h1>
    <!-- Button to join the room -->
    <button id="joinBtn">Join Room</button>

    <!-- Placeholder for local video -->
    <video
      id="localVideo"
      autoplay
      muted
      playsinline
      style="width:400px; border:1px solid #333;"
    ></video>

    <!-- Load JS module -->
    <script type="module" src="app.jsx"></script>
  </body>
</html>
```

- **`<button id="joinBtn">`**: User clicks to start.
- **`<video id="localVideo">`**: Placeholder for camera feed.
- **`type="module"`**: Allows `import` in `app.jsx`.

### JavaScript Logic (Line-by-Line) (`app.jsx`)

```js
import { Room } from "livekit-client";

// 1. LiveKit server URL (WebSocket)
const wsUrl = "wss://solvd-x191iqhu.livekit.cloud";
// 2. JWT token generated by backend
const token = "<PASTE_YOUR_JWT_HERE>";

// 3. Wait for the Join button click
document.getElementById("joinBtn").addEventListener("click", async () => {
  // 4. Instantiate a new Room client
  const room = new Room();

  try {
    // 5. Connect to LiveKit room with wsUrl & token
    await room.connect(wsUrl, token);
    console.log("‚úÖ Connected to room:", room.name);

    // 6. Enable and publish camera track
    await room.localParticipant.setCameraEnabled(true);
    console.log("üé• Camera published");
    // 7. Enable and publish mic track
    await room.localParticipant.setMicrophoneEnabled(true);
    console.log("üé§ Mic published");

    // 8. Retrieve the published video track
    const publication = room.localParticipant.getTrackPublication("camera");
    const videoTrack = publication?.videoTrack;

    if (videoTrack) {
      // 9. Create a <video> element bound to the track
      const element = videoTrack.attach();
      // 10. Replace placeholder <video> with this element
      document.getElementById("localVideo").replaceWith(element);
      element.id = "localVideo"; // preserve styling
      console.log("üì∫ Local video attached");
    }
  } catch (err) {
    // 11. Handle errors from connect/publish
    console.error("‚ùå Error:", err);
  }
});
```

1. **Import** `Room` from the SDK.
2. **Define** your LiveKit URL & token.
3. **Add** event listener to the Join button.
4. **Create** a Room client instance.
5. **Connect** using WebSocket URL + JWT.
6. **Publish** camera track with a single call.
7. **Publish** microphone track similarly.
8. **Fetch** the published camera track object.
9. **Attach** it to a new `<video>` element.
10. **Replace** the placeholder in the DOM.
11. **Catch** and log any runtime errors.

---

## Running the Example

1. **Backend**:

   ```bash
   cd backend
   source venv/bin/activate
   python generate_token.py
   ```

2. **Frontend**:

   ```bash
   cd frontend
   npm install
   npx vite      # or any static server
   ```

3. **Open** `http://localhost:5173` in browser
4. Click **Join Room**, allow camera/mic, and see your feed!

---

## How It Works

1. User clicks **Join Room**.
2. Frontend creates a `Room` and **connects** with token.
3. LiveKit server **validates** JWT, **creates** room if needed.
4. Frontend **enables** and **publishes** camera & mic.
5. Browser **renders** your local video via WebRTC.
